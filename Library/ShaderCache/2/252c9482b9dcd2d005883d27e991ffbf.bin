ganizationId});return 0==b.length&&(b=a.filter(function(a){return a.name===e.projectInfo.organizationId})),_.head(b)})},l.GetOrganizationsByProjectRole=function(){var a=e.projectInfo.permissions.project;return l.GetFilteredMemberOrganizations(function(b){return b.role.value>=a.value})},l.GetMemberManagerOrganizations=function(){return l.GetFilteredMemberOrganizations(function(a){return a.role.value>=g.manager.value})},l.RenameProject=function(b){return e.projectInfo.projectName==b&&a.when(204),e.IsReady().then(function(d){var f=e.projectInfo.projectGUID,g=e.projectInfo.organizationId,h=e.urls.core,i={name:b},j=h+"/api/projects/"+f;return c.put(j,i).then(function(b){var d=b.status;return 204==d?(j=h+"/api/projects/"+f,c.get(j,b.config).then(function(a){var b=a.data;return e._BindProject(f,b.name,g).success(function(){return e.projectInfo.projectName=b.name,d})})):a.reject(b)})})},l.MoveProject=function(b){return e.projectInfo.organizationId==b.id&&a.when(204),e.IsReady().then(function(a){return e.GetCoreConfigurationUrl().success(function(a){var d=e.projectInfo.projectGUID,f=e.projectInfo.organizationId,g={destination_org_fk:b.foreign_key},h=a+"/api/orgs/"+f+"/projects/"+d+"/move";return c.put(h,g).then(function(a){return e.projectInfo.organizationId=b.id,a.status})})})},l.EnableProject=function(a){return h.IsReady().then(function(){return h.GetProjectName().then(function(b){return k(b,a,0)})})},l.GetProjects=function(f,g){if(void 0===g||!1===g){if(void 0!==b.get(f+"-projects")){var h=d[f+"-projects"];if(void 0!==h)return a.when(h)}}return e.IsReady().then(function(g){var h=e.urls.core+"/api/orgs/"+f+"/projects";return c.get(h).then(function(a){var c=j(a.data.projects);return b.put(f+"-projects","InLocalStorage",i(15)),d[f+"-projects"]=c,c},function(c){return b.remove(f+"-projects"),delete d[f+"-projects"],a.reject(c)})})},l.GetProject=function(f,g){if(void 0===g||!1===g){if(void 0!==b.get(f)){var h=d[f];if(void 0!==h)return a.when(h)}}return e.IsReady().then(function(g){var h=e.urls.core+"/api/projects/"+f;return c.get(h).then(function(a){var c=a.data;return b.put(f,"InLocalStorage",i(15)),d[f]=c,c},function(c){return b.remove(f),delete d[f],a.reject(c)})})},l.InvalidateCachedProject=function(a){b.remove(a),delete d[a]},l.GetAllProjects=function(f){if(void 0===f||!1===f){if(void 0!==b.get("projects")){var g=d.projects;if(void 0!==g)return a.when(g)}}return e.IsReady().then(function(f){var g=e.urls.core+"/api/projects";return c.get(g).then(function(a){var c=j(a.data.projects);return b.put("projects","InLocalStorage",i(15)),d.projects=c,c},function(c){return b.remove("projects"),delete d.projects,a.reject(c)})})},l.GetOrganizationMembers=function(f,g){if(void 0===g||!1===g){if(void 0!==b.get(f.id+"-members")){var h=d[f.id+"-members"];if(void 0!==h)return a.when(h)}}return e.IsReady().then(function(g){var h=e.urls.core+"/api/orgs/"+f.id+"/users";return c.get(h).then(function(a){return b.put(f.id+"-members","InLocalStorage",i(15)),d[f.id+"-members"]=a.data.users,a.data.users},function(c){return b.remove(f.id+"-members"),delete d[f.id+"-members"],a.reject(c)})})},l.CheckTeamSeats=function(b){return l.getConfigEntry("seat_required").then(function(d){return d?e.IsReady().then(function(){var d=e.urls.identity+"/v1/entitlements",f={params:{userId:e.userInfo.userId,assignFrom:e.projectInfo.organizationForeignKey,isActive:!0,namespace:"unity_teams",type:"TEAMS",tag:["UnityTeamsFree","UnityTeamsStandard","UnityTeamsPro"]}};return c.get(d,f).then(function(a){var c=_.map(a.data.results,"tag");return c.length>0&&(!b||!!_.intersection(c,["UnityTeamsStandard","UnityTeamsPro"]).length)},function(){return a.reject("Issue fetching entitlements")})}):void 0!==d||a.reject("Issue fetching configuration")},function(){return a.reject("Issue fetching configuration")})},l.SetCOPPACompliance=function(b){return e.IsReady().then(function(d){var f=e.projectInfo.projectGUID,g=e.projectInfo.organizationId,h={coppa:b},i=e.urls.core+"/api/orgs/"+g+"/projects/"+f+"/coppa";return c.put(i,h).then(function(c){if(204==c.status){var d=0;return"compliant"==b?d=1:"not_compliant"==b&&(d=2),e.SetCOPPACompliance(d).success(function(){e.projectInfo.COPPA=b})}return a.reject(c)})})},l.InvalidateCachedServiceFlags=function(){var c=e.projectInfo.projectGUID,f=a.defer();return c?(b.remove(c+"-serviceflags"),b.remove(c+"-serviceflags-request"),delete d[c+"-serviceflags"],n=0,f.resolve(),f.promise):f.reject("No projectId found")};var m=[1,2,4,7,10,15],n=0;return l.GetServiceFlags=function(f){var g=e.projectInfo.projectGUID;if(!g){var h={status:422,statusText:"No valid project id present to retrieve services flags"};return a.reject(h)}if(void 0===f||!1===f){var j=b.get(g+"-serviceflags"),k=b.get(g+"-serviceflags-request");if(void 0!==j||void 0!==k){var l=d[g+"-serviceflags"];if(void 0!==l)return a.when(l)}}return e.IsReady().then(function(a){var f={ignoreLoadingBar:!0},h=e.urls.core+"/api/projects/"+g+"/service_flags";return b.put(g+"-serviceflags-request","Sent",i(1)),c.get(h,f).then(function(a){return b.remove(g+"-serviceflags-request"),b.put(g+"-serviceflags","InLocalStorage",i(15)),d[g+"-serviceflags"]=a.data,n=0,a.data},function(a){b.remove(g+"-servicefla