;return j=void 0!==d||d?j+"include=changes&":j,j=void 0!==g||g?j+"limit="+g+"&":j,c.get(j,i).then(function(a){if(void 0!==b){var c=!1;_.each(a.data.revisions,function(a,d){a.hasOwnProperty("changes")&&f(a),a.id==b&&(a.currentRevision=!0,c=!0),c&&(a.obtained=!0)})}return a.data.revisions})})},g.getRevision=function(a,b){var d={ignoreLoadingBar:!0},f=a.id||e.projectInfo.projectGUID,g=e.urls.collab+"/api/projects/"+f+"/branches/master/revisions/"+b;return c.get(g,d).then(function(a){return a.data})},g.getRevisionDetails=function(a,b){var d={ignoreLoadingBar:!0},f=a.id||e.projectInfo.projectGUID,g=e.urls.collab+"/api/projects/"+f+"/branches/master/revisions/"+b+"?include=changes";return c.get(g,d).then(function(a){return _.filter(a.data.changes,function(a){return!endsWith(a.path,".meta")})})},g.refreshChannelAccess=function(){var b=a.defer();return e.IsReady().then(function(a){b.resolve({project_id:e.projectInfo.projectGUID,full_url:e.urls.collab+"/api/refresh_channel_access"})}),b.promise},g}]),angular.module("ngUnity.cloudcollab").factory("errorHandlerInterface",["$q","utAlert","defaultHttpErrors","MessageGroup","toArray","httpErrorConfigs",function(a,b,c,d,e,f){function g(a,b,c){b=b||new d;var f=b.getErrorConfig(a)||c.getErrorConfig(a);f.handler=f.handler||angular.noop,f.handler=e(f.handler);var g=b.all||c.all;return g&&f.handler.push(g.handler),f}return function(d,e){var h=f[d.method]||c;return{handleErrors:function(c){return e.error(function(e){var f;e&&void 0!==e.status&&(f=e.status||e);var i=g(f,c,h);return f&&i&&(i.message&&b.setError(i.message),i.handler.forEach(function(a){a(e,d)})),a.reject(e)})}}}}]),angular.module("ngUnity.cloudcore",["ngUnity.connectService","ut.components","ngUnity.errors","ngUnity.general"]).factory("Organization",["Roles",function(a){function b(b,c,d,e,f){this.name=b,this.foreign_key=c,this.id=d,this.billable_user_fk=e,this.role=a.FromString(f)}return b.FromOAuth2=function(a){return new b(a.name,a.foreign_key,a.id,a.billable_user_fk,a.role)},b}]).factory("RoleValues",function(){return{owner:30,manager:20,user:10}}).factory("Roles",["Role","RoleValues",function(a,b){var c=_.mapValues(b,function(b,c){return new a(c,b)});return c.FromString=function(b){return b instanceof a?b:_.find(_.values(c),function(a){return a.name.toLowerCase()==b.toLowerCase()})},c}]).factory("Role",["RoleValues",function(a){function b(a,b){this.name=a,this.value=b}return b.prototype={hasEditRights:function(){return this.value>=a.manager}},b}]).factory("ServiceFlags",["$q","$injector","$rootScope","cloudcoreUi",function(a,b,c,d){function e(){this._ready=a.defer(),this._fetching=!1,this.fetched=!1,this.clear()}return e.prototype={ready:function(){return this._ready.promise},clear:function(){this.flags=void 0},get:function(a){if(this.flags)return this.flags[a]},update:function(b){return this._fetching?a.when():b.projectBound&&b.projectGUID?(this._fetching=!0,d.GetServiceFlags(!0).success(function(a){this.flags=a.service_flags,c.$broadcast("servicesChanged",this.flags)}.bind(this)).error(function(a){this.flags={},c.$broadcast("servicesChanged",this.flags)}.bind(this)).final(function(){this.fetched=!0,this._fetching=!1,this._ready.resolve(this)}.bind(this))):(this.fetched=!0,this.clear(),c.$broadcast("servicesChanged",this.flags),this._ready.resolve(this),a.when())}},e}]).factory("Rights",function(){return{organization:"org",project:"project"}}).factory("Permissions",["$q","$injector","Role","cloudcoreUi","Rights","Roles",function(a,b,c,d,e,f){function g(){this._ready=a.defer(),this._fetching=!1,this._unauthorized=!1,this.fetched=!1,this.clear()}return g.prototype={_getSelf:function(a){var c=b.get("unityConnectService");return _.find(a,function(a){return a.email===c.userInfo.userName})},ready:function(){return this._ready.promise},clear:function(){this.project=void 0,this.organization=void 0,this.organizationAccess=!1},update:function(b){if(!this._fetching&&!this._unauthorized){if(!b.projectBound||!b.projectGUID)return this.fetched=!0,this.clear(),void this._ready.resolve(this);this._fetching=!0;var c={id:b.projectGUID,orgId:b.organizationId},g=d.GetProjectMembers(c,!0).success(function(a){var b=this._getSelf(a);b&&(this.project=f.FromString(b.role),this.organizationAccess=b.access_granted_by===e.organization)}.bind(this)).error(function(){this._unauthorized=!0}.bind(this)),h=d.GetProjectOrganization().success(function(a){this.organization=a?a.role:void 0}.bind(this));a.all([g,h]).success(function(a){}.bind(this)).final(function(){this.fetched=!0,this._fetching=!1,this._ready.resolve(this)}.bind(this))}},userChanged:function(){this._unauthorized=!1},hasEditRights:function(){return!!this.project&&this.project.hasEditRights()}},g}]).factory("cloudcore",["$q","$cookies","$http","$localStorage","unityConnectService","Organization","Roles","unityProjectService",function(a,b,c,d,e,f,g,h){function i(a){var b=new Date;return b.setMinutes(b.getMinutes()+a),{expires:b}}function j(a){return a=a.filter(function(a){return!a.archived&&a.active}),a.sort(function(a,b){return a.name.localeCompare(b.name)}),a}function k(b,d,f){var g={name:b+(0==f?"":" ("+f+")"),active:!0},h=e.urls.core+"/api/orgs/"+d+"/projects";return c.post(h,g).then(function(b){var c=b.data;return 201==b.status?e._BindProject(c.guid,c.name,c.org_id).success(function(){return e.projectInfo.projectGUID=c.guid,e.projectInfo.projectName=c.name,e.projectInfo.organizationId=c.org_id,e.projectInfo.projectBound=!0,!0}):a.reject(b)},function(c){return 422==c.status?k(b,d,f+1):(e.projectInfo.projectBound=!1,a.reject(c))})}var l={};l.GetOrganizations=function(d){if(void 0===d||!1===d){var f=b.getObject("organizations");if(void 0!==f)return a.when(f)}return e.IsReady().then(function(d){var f=e.urls.core+"/api/orgs";return c.get(f).then(function(a){return a.data.orgs.sort(function(a,b){return a.name.localeCompare(b.name)}),b.putObject("organizations",a.data.orgs,i(15)),a.data.orgs},function(c){return b.remove("organizations"),a.reject(c)})})},l.GetProjectMembers=function(f,g){if(void 0===g||!1===g){if(void 0!==b.get(f.id+"-members")){var h=d[f.id+"-members"];if(void 0!==h)return a.when(h)}}return e.IsReady().then(function(g){var h=f.id||e.projectInfo.projectGUID,j=f.orgId||e.projectInfo.organizationId;if(!j)return a.reject("No valid organization id present to retrieve project members.");var k={ignoreLoadingBar:!0},l=e.urls.core+"/api/orgs/"+j+"/projects/"+h+"/users";return c.get(l,k).then(function(a){return b.put(f.id+"-members","InLocalStorage",i(15)),d[f.id+"-members"]=a.data.users,a.data.users},function(c){return b.remove(f.id+"-members"),delete d[f.id+"-members"],a.reject(c)})})},l.SetMemberRole=function(f,g){return e.IsReady().then(function(h){var i=e.projectInfo.projectGUID,j=e.projectInfo.organizationId,k={role:g},l=e.urls.core+"/api/orgs/"+j+"/projects/"+i+"/users/"+f.foreign_key;return c.put(l,k).then(function(a){b.remove(i.id+"-members"),delete d[i.id+"-members"]},function(c){return b.remove(i.id+"-members"),delete d[i.id+"-members"],a.reject(c)})})},l.InviteMember=function(a,b){return e.IsReady().then(function(d){var f=e.projectInfo.projectGUID,g=e.projectInfo.organizationId,h={email:a,role:b},i=e.urls.core+"/api/orgs/"+g+"/projects/"+f+"/users";return c.post(i,h).then(function(a){return a.data})})},l.RemoveProjectMember=function(f){return e.IsReady().then(function(g){var h=e.projectInfo.projectGUID,i=e.projectInfo.organizationId,j=e.urls.core+"/api/orgs/"+i+"/projects/"+h+"/users/"+f.foreign_key;return c.delete(j).then(function(a){return b.remove(h.id+"-members"),delete d[h.id+"-members"],a.data},function(c){return b.remove(h.id+"-members"),delete d[h.id+"-members"],a.reject(c)})})},l.GetMemberOrganizations=function(){return e.IsReady().then(function(a){var b={ignoreLoadingBar:!0},d=e.urls.core+"/api/users/me?include=orgs";return c.get(d,b).then(function(a){var b=[];return a.data.org